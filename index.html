<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cat√°logo Tecnolog√≠a y Hogar - Forwarder Venture</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap');
        body { background-color: #F8FAFC; font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        
        .text-fv-blue { color: #002e5f; }
        .bg-fv-blue { background-color: #002e5f; }
        .text-fv-orange { color: #e85d04; }
        .bg-fv-orange { background-color: #e85d04; }
        
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        .btn-variant.active { background-color: #002e5f; color: white; border-color: #002e5f; }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <div class="max-w-[1400px] mx-auto bg-white min-h-screen shadow-xl w-full flex flex-col relative">
        
        <header class="bg-white/90 backdrop-blur-md px-6 py-4 sticky top-0 z-50 flex justify-between items-center border-b border-gray-100 h-[80px]">
            <img src="logo.jpg" alt="Forwarder Venture" class="h-12 object-contain">
            <button onclick="toggleCart()" class="relative p-2 hover:bg-gray-100 rounded-full transition">
                <i class="fa-solid fa-cart-shopping text-2xl text-fv-blue"></i>
                <span id="cart-count" class="absolute -top-1 -right-1 bg-red-600 text-white text-[10px] font-bold h-5 w-5 flex items-center justify-center rounded-full border-2 border-white">0</span>
            </button>
        </header>

        <section class="relative h-[25vh] md:h-[35vh] bg-fv-blue flex items-center px-8 overflow-hidden">
            <img src="https://images.unsplash.com/photo-1518770660439-4636190af475?q=80&w=2070&auto=format&fit=crop" class="absolute inset-0 w-full h-full object-cover opacity-30">
            <div class="relative z-10">
                <h1 class="text-white font-black text-4xl md:text-6xl tracking-tight">TECNOLOG√çA <br><span class="text-orange-500">&</span> HOGAR</h1>
                <p class="text-gray-200 mt-2 font-medium">Soluciones inteligentes para tu d√≠a a d√≠a.</p>
            </div>
        </section>

        <div class="sticky top-[80px] z-40 bg-white border-b border-gray-100 p-4 shadow-sm">
            <div class="flex flex-col md:flex-row gap-4 justify-between items-center">
                <nav id="category-nav" class="flex overflow-x-auto gap-2 w-full md:w-auto hide-scrollbar pb-2 md:pb-0"></nav>
                <div class="relative w-full md:w-72">
                    <i class="fa-solid fa-magnifying-glass absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                    <input type="text" id="search-input" oninput="applyFilters()" placeholder="Buscar producto..." class="w-full pl-10 pr-4 py-2 bg-gray-50 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-fv-blue/20">
                </div>
            </div>
        </div>

        <main class="p-6 flex-grow bg-gray-50">
            <div id="product-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-6">
                </div>
        </main>

        <footer class="bg-gray-900 text-white p-10 text-center border-t-4 border-fv-orange">
            <p class="font-black text-xl mb-2 tracking-tighter uppercase">Forwarder Venture</p>
            <p class="text-gray-500 text-sm mb-6 uppercase tracking-widest">Tecnolog√≠a y Hogar</p>
            <div class="flex justify-center gap-4">
                <a href="https://wa.me/573183035997" target="_blank" class="w-10 h-10 bg-green-600 rounded-full flex items-center justify-center hover:scale-110 transition">
                    <i class="fa-brands fa-whatsapp"></i>
                </a>
            </div>
        </footer>
    </div>

    <div id="product-modal" class="hidden fixed inset-0 bg-black/70 z-[100] flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white w-full max-w-4xl rounded-3xl overflow-hidden flex flex-col md:flex-row relative animate-scale-in">
            <button onclick="closeProductModal()" class="absolute top-4 right-4 w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center z-10"><i class="fa-solid fa-xmark"></i></button>
            
            <div class="w-full md:w-1/2 bg-gray-100 p-8 flex items-center justify-center">
                <img id="modal-img" src="" class="max-h-[400px] object-contain drop-shadow-lg">
            </div>

            <div class="w-full md:w-1/2 p-8 flex flex-col">
                <span id="modal-category" class="text-fv-orange font-black text-xs uppercase tracking-widest mb-2">Categor√≠a</span>
                <h2 id="modal-title" class="text-3xl font-black text-gray-900 mb-4 leading-tight">Nombre del Producto</h2>
                
                <div class="mb-6">
                    <span class="text-gray-400 text-xs font-bold uppercase block mb-1">Precio Online</span>
                    <span id="modal-price" class="text-4xl font-black text-fv-blue"></span>
                </div>

                <div id="variant-section" class="mb-6 hidden">
                    <label class="text-xs font-bold text-gray-400 uppercase mb-2 block">Opciones disponibles:</label>
                    <div id="variant-container" class="flex flex-wrap gap-2"></div>
                </div>

                <div class="mt-auto pt-6 flex flex-col gap-3">
                    <div class="flex items-center gap-4 mb-4">
                        <div class="flex items-center border-2 border-gray-100 rounded-2xl p-1 bg-gray-50">
                            <button onclick="updateQty(-1)" class="w-10 h-10 font-bold text-xl">-</button>
                            <input type="number" id="modal-qty" value="1" min="1" class="w-12 text-center bg-transparent font-bold">
                            <button onclick="updateQty(1)" class="w-10 h-10 font-bold text-xl">+</button>
                        </div>
                        <p class="text-xs text-gray-400 font-medium">SKU: <span id="modal-sku" class="text-gray-600"></span></p>
                    </div>
                    <button id="add-to-cart-btn" class="w-full bg-fv-blue text-white py-4 rounded-2xl font-black text-lg shadow-lg shadow-blue-900/20 hover:bg-fv-blue/90 transition">A√±adir al Carrito</button>
                </div>
            </div>
        </div>
    </div>

    <div id="cart-modal" class="hidden fixed inset-0 bg-black/60 z-[200] flex justify-end">
        <div class="bg-white w-full max-w-md h-full shadow-2xl flex flex-col animate-slide-in">
            <div class="p-6 border-b flex justify-between items-center">
                <h2 class="text-2xl font-black text-fv-blue">Tu Pedido</h2>
                <button onclick="toggleCart()" class="text-gray-400 hover:text-gray-600"><i class="fa-solid fa-xmark text-xl"></i></button>
            </div>
            <div id="cart-items" class="flex-grow overflow-y-auto p-6 space-y-4 bg-gray-50"></div>
            <div class="p-6 border-t bg-white">
                <div class="flex justify-between items-center mb-6">
                    <span class="font-bold text-gray-500">Total:</span>
                    <span id="cart-total" class="text-3xl font-black text-fv-blue">$0</span>
                </div>
                <button onclick="sendToWhatsApp()" class="w-full bg-green-500 text-white py-4 rounded-2xl font-black text-lg flex items-center justify-center gap-3">
                    <i class="fa-brands fa-whatsapp text-2xl"></i> Enviar a WhatsApp
                </button>
            </div>
        </div>
    </div>

    <script>
        const WHATSAPP_NUMBER = '3183035997';
        const SHEET_ID = '17a0Pxq1EOLRf86yiuM014ZluVqL2Qj1Mt8cKRDenjHc';
        const GID = '0'; // Hoja "Catalogo"
        const CSV_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/export?format=csv&gid=${GID}`;

        let allProducts = [];
        let cart = [];
        let currentCategory = 'Ver Todo';

        function formatMoney(amount) {
            return amount.toLocaleString('es-CO', { style: 'currency', currency: 'COP', minimumFractionDigits: 0 });
        }

        function loadProducts() {
            Papa.parse(CSV_URL, {
                download: true,
                header: true,
                skipEmptyLines: true,
                complete: function(results) {
                    const tempGroups = {};
                    results.data.forEach(row => {
                        const sku = row['SKU']?.trim();
                        const pSku = row['PARENT SKU']?.trim();
                        if (!sku) return;

                        const groupId = pSku || sku;
                        if (!tempGroups[groupId]) {
                            tempGroups[groupId] = {
                                id: groupId,
                                nombre: row['NOMBRE'],
                                tipo: row['TIPO'] || 'Varios',
                                variaciones: []
                            };
                        }

                        // El error del precio en 0 se corrige aqu√≠ usando el nombre de columna correcto
                        const precio = parseFloat(row['PRECIO DE VENTA']?.replace(/[^0-9.]/g, '')) || 0;

                        tempGroups[groupId].variaciones.push({
                            sku: sku,
                            variable: row['VARIABLE'] || '',
                            img: row['IMAGEN']?.split(',')[0].trim() || 'https://via.placeholder.com/400',
                            precio: precio
                        });
                    });

                    allProducts = Object.values(tempGroups);
                    updateCategoryNav();
                    applyFilters();
                }
            });
        }

        function updateCategoryNav() {
            const types = ['Ver Todo', ...new Set(allProducts.map(p => p.tipo))].sort();
            document.getElementById('category-nav').innerHTML = types.map(t => `
                <button onclick="filterType('${t}')" class="px-5 py-2 rounded-full text-sm font-bold whitespace-nowrap border transition-all ${t === currentCategory ? 'bg-fv-blue text-white' : 'bg-white text-gray-500 hover:bg-gray-100'}">${t}</button>
            `).join('');
        }

        function filterType(t) {
            currentCategory = t;
            updateCategoryNav();
            applyFilters();
        }

        function applyFilters() {
            const search = document.getElementById('search-input').value.toLowerCase();
            const filtered = allProducts.filter(p => {
                const matchType = currentCategory === 'Ver Todo' || p.tipo === currentCategory;
                const matchSearch = p.nombre.toLowerCase().includes(search);
                return matchType && matchSearch;
            });
            renderGrid(filtered);
        }

        function renderGrid(products) {
            const grid = document.getElementById('product-grid');
            if (products.length === 0) {
                grid.innerHTML = `<div class="col-span-full py-20 text-center text-gray-400 font-bold">No encontramos productos</div>`;
                return;
            }
            grid.innerHTML = products.map(p => {
                const main = p.variaciones[0];
                return `
                    <div class="bg-white rounded-2xl overflow-hidden shadow-sm hover:shadow-xl transition-all border border-gray-100 flex flex-col cursor-pointer group" onclick="openProductModal('${p.id}')">
                        <div class="aspect-square p-4 flex items-center justify-center bg-gray-50">
                            <img src="${main.img}" class="max-h-full object-contain group-hover:scale-110 transition duration-500">
                        </div>
                        <div class="p-4">
                            <p class="text-[10px] text-fv-orange font-black uppercase mb-1">${p.tipo}</p>
                            <h3 class="font-bold text-sm text-gray-900 line-clamp-2 h-10 mb-2">${p.nombre}</h3>
                            <p class="text-fv-blue font-black text-lg">${formatMoney(main.precio)}</p>
                        </div>
                    </div>
                `;
            }).join('');
        }

        let selectedProduct = null;
        let selectedVar = null;

        function openProductModal(id) {
            selectedProduct = allProducts.find(p => p.id === id);
            selectedVar = selectedProduct.variaciones[0];
            
            document.getElementById('modal-title').innerText = selectedProduct.nombre;
            document.getElementById('modal-category').innerText = selectedProduct.tipo;
            document.getElementById('modal-qty').value = 1;
            
            updateModalData();
            
            document.getElementById('product-modal').classList.remove('hidden');
        }

        function updateModalData() {
            document.getElementById('modal-img').src = selectedVar.img;
            document.getElementById('modal-sku').innerText = selectedVar.sku;
            document.getElementById('modal-price').innerText = formatMoney(selectedVar.precio);

            const vSection = document.getElementById('variant-section');
            if (selectedProduct.variaciones.length > 1) {
                vSection.classList.remove('hidden');
                document.getElementById('variant-container').innerHTML = selectedProduct.variaciones.map((v, i) => `
                    <button onclick="selectVar(${i})" class="px-4 py-2 border-2 rounded-xl text-xs font-bold transition-all ${v === selectedVar ? 'border-fv-blue bg-fv-blue text-white' : 'border-gray-100 text-gray-500'}">${v.variable || 'Opc '+(i+1)}</button>
                `).join('');
            } else {
                vSection.classList.add('hidden');
            }

            document.getElementById('add-to-cart-btn').onclick = () => addToCart();
        }

        function selectVar(i) {
            selectedVar = selectedProduct.variaciones[i];
            updateModalData();
        }

        function updateQty(v) {
            const input = document.getElementById('modal-qty');
            let n = parseInt(input.value) + v;
            input.value = n < 1 ? 1 : n;
        }

        function closeProductModal() {
            document.getElementById('product-modal').classList.add('hidden');
        }

        function addToCart() {
            const qty = parseInt(document.getElementById('modal-qty').value);
            const item = {
                sku: selectedVar.sku,
                nombre: selectedProduct.nombre,
                variable: selectedVar.variable,
                precio: selectedVar.precio,
                img: selectedVar.img,
                qty: qty
            };

            const exists = cart.find(c => c.sku === item.sku);
            if (exists) exists.qty += qty; else cart.push(item);
            
            updateCartUI();
            closeProductModal();
        }

        function updateCartUI() {
            document.getElementById('cart-count').innerText = cart.reduce((acc, i) => acc + i.qty, 0);
            let total = 0;
            document.getElementById('cart-items').innerHTML = cart.map((item, i) => {
                total += item.precio * item.qty;
                return `
                    <div class="flex gap-4 bg-white p-3 rounded-2xl border border-gray-100">
                        <img src="${item.img}" class="w-16 h-16 object-contain bg-gray-50 rounded-lg">
                        <div class="flex-grow">
                            <p class="font-bold text-xs text-fv-blue line-clamp-1">${item.nombre}</p>
                            <p class="text-[10px] text-gray-400">Cant: ${item.qty} x ${formatMoney(item.precio)}</p>
                            <p class="font-black text-sm">${formatMoney(item.precio * item.qty)}</p>
                        </div>
                        <button onclick="removeCart(${i})" class="text-red-300 hover:text-red-500"><i class="fa-solid fa-trash-can"></i></button>
                    </div>
                `;
            }).join('');
            document.getElementById('cart-total').innerText = formatMoney(total);
        }

        function removeCart(i) { cart.splice(i, 1); updateCartUI(); }
        function toggleCart() { document.getElementById('cart-modal').classList.toggle('hidden'); }

        function sendToWhatsApp() {
            if (cart.length === 0) return;
            let msg = `üõí *NUEVO PEDIDO - FORWARDER VENTURE*%0A%0A`;
            let total = 0;
            cart.forEach(item => {
                msg += `‚Ä¢ *${item.nombre}*%0A  Cant: ${item.qty} x ${formatMoney(item.precio)}%0A  Subtotal: ${formatMoney(item.precio * item.qty)}%0A%0A`;
                total += item.precio * item.qty;
            });
            msg += `*TOTAL A PAGAR: ${formatMoney(total)}*%0A%0A_Quedo atento a la confirmaci√≥n de pago y env√≠o._`;
            window.open(`https://wa.me/${WHATSAPP_NUMBER}?text=${msg}`, '_blank');
        }

        loadProducts();
    </script>

    <style>
        @keyframes scale-in { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        @keyframes slide-in { from { transform: translateX(100%); } to { transform: translateX(0); } }
        .animate-scale-in { animation: scale-in 0.3s ease-out forwards; }
        .animate-slide-in { animation: slide-in 0.3s ease-out forwards; }
    </style>
</body>
</html>
